(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fd211cf6"],{"131d":function(t,e,s){"use strict";var i=s("8415"),a=s.n(i);a.a},"572f":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"order-top-button"},[s("div",{staticStyle:{width:"100px"}},[s("el-button",{attrs:{size:"small"},on:{click:function(e){return t.$router.go(-1)}}},[t._v("返回")])],1),s("div",{staticStyle:{width:"calc(100% - 100px)"}},["pending"===t.status?s("el-button",{attrs:{size:"small",type:"info"},on:{click:t.closedOrder}},[t._v("关闭订单")]):t._e(),-1===["processing","sent","partial","success"].indexOf(t.status)||t.refund_status?t._e():s("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){return t.refundOrder("refunded")}}},[t._v("退单")]),"refunding"===t.refund_status?s("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.refundOrder("refunded")}}},[t._v("同意退单")]):t._e(),"refunding"===t.refund_status?s("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(e){return t.refundOrder("refund_refuse")}}},[t._v("拒绝退单")]):t._e()],1)]),s("div",{staticClass:"order-top",staticStyle:{width:"calc(100% - 2px)"}},[s("el-steps",{attrs:{active:t.status_active,"finish-status":"cancel"===t.status||"closed"===t.status||"refunded"===t.status?"wait":"success",simple:""}},t._l(t.status_processes,(function(t,e){return s("el-step",{key:e,attrs:{title:t.value}})})),1)],1),s("div",{staticClass:"order-contain"},[s("div",{staticClass:"order-main"},[s("div",[s("div",{staticClass:"order-block-title"},[s("strong",[t._v("商品详情")]),"partial"===t.status||"processing"===t.status?s("el-button",{staticStyle:{padding:"5px 10px","margin-left":"20px"},attrs:{type:"primary",size:"small"},on:{click:t.toSend}},[t._v("发货")]):t._e()],1),t._l(t.items,(function(e,i){return s("div",{key:i,staticClass:"order_items"},[s("div",{staticClass:"order_items_img"},[s("el-image",{staticStyle:{width:"60px",height:"60px"},attrs:{src:e.img_url,fit:"contain"}})],1),s("div",{staticClass:"order_items_info",staticStyle:{width:"calc(100% - 200px)"}},[s("div",[t._v(t._s(e.product_title))]),s("div",{staticClass:"sub-title"},[t._v("规格："+t._s(e.variant_title))])]),s("div",{staticClass:"order_items_quantity",staticStyle:{width:"120px"}},[s("div",[t._v("¥ "),s("strong",[t._v(t._s(e.price))]),t._v(" x "),s("strong",[t._v(t._s(e.quantity))])]),s("div",[t._v("共 ¥ "+t._s(e.total))])])])})),s("div",{staticClass:"order-price-list"},[s("div",[s("div",[t._v("商品总计：")]),s("div",[t._v("¥ "+t._s(t.items_amount))])]),s("div",[s("div",[t._v("运费总计：")]),s("div",[t._v("¥ "+t._s(t.shipments_amount))])]),s("div",[s("div",[t._v("优惠总计：")]),s("div",[t._v("-¥ "+t._s(t.discounts_amount))])]),s("div",[s("div",[t._v("订单总计：")]),t.ori_amount==t.amount?s("div",[t._v("¥ "),s("strong",{staticStyle:{"font-size":"16px"}},[t._v(t._s(t.amount))])]):s("div",[s("div",{staticStyle:{"text-decoration":"line-through"}},[t._v("¥ "+t._s(t.ori_amount))]),s("div",[t._v("¥ "),s("strong",{staticStyle:{"font-size":"16px"}},[t._v(t._s(t.amount))])])])]),"pending"==t.status?s("div",[s("el-button",{staticStyle:{float:"right",padding:"3px 0","margin-right":"10px"},attrs:{type:"text"},on:{click:t.updatePriceOrder}},[t._v("修改价格")])],1):t._e()])],2),s("div",{staticClass:"order-remark"},[t._m(0),s("div",{staticStyle:{padding:"10px","background-color":"#fff","min-height":"50px"}},[t._v(t._s(t.remark?t.remark:"暂无"))])]),s("div",[s("div",{staticClass:"order-block-title"},[t._v("配送列表")]),0!==t.shipments.length?s("div",{staticStyle:{padding:"10px","background-color":"#fff"}},[s("el-collapse",t._l(t.shipments,(function(e,i){return s("el-collapse-item",{key:i,attrs:{title:"运单 "+(i+1),name:i}},[s("div",[s("div",{staticStyle:{display:"inline-block",width:"70px"}},[t._v("运输方式：")]),s("div",{staticStyle:{display:"inline-block"}},[t._v(t._s(e.shipment_company))])]),s("div",[s("div",{staticStyle:{display:"inline-block",width:"70px"}},[t._v("运单号：")]),s("div",{staticStyle:{display:"inline-block"}},[t._v(t._s(e.shipment_no))])]),s("div",[s("ul",{staticClass:"shipment-item"},t._l(e.items,(function(e,i){return s("li",{key:i},[s("span",[s("strong",[t._v(t._s(e.product_title))])]),s("span",{staticStyle:{"margin-left":"10px"}},[t._v("规格："+t._s(e.variant_title))]),s("span",{staticStyle:{"margin-left":"20px"}},[t._v(" x "+t._s(e.quantity))])])})),0)])])})),1)],1):s("div",{staticStyle:{padding:"10px","background-color":"#fff","min-height":"50px"}},[t._v("还未配送")])])]),s("div",{staticClass:"order-subside"},[s("div",{staticClass:"order-subside-card"},[s("div",{staticClass:"order-block-title"},[t._v("订单信息")]),s("div",{staticClass:"order-block-content"},[s("div",[s("div",[t._v("订单编号：")]),s("div",[t._v(t._s(t.no))])]),t.payment?s("div",[s("div",[t._v("支付方式：")]),s("div",[t._v(t._s(t.payment.payment_method))])]):t._e(),t.payment?s("div",[s("div",[t._v("支付时间：")]),s("div",[t._v(t._s(t.payment.created_at))])]):t._e()])]),s("div",{staticClass:"order-subside-card"},[s("div",{staticClass:"order-block-title"},[t._v("客户信息")]),s("div",{staticClass:"order-block-content"},[s("div",[s("div",[t._v("用户名：")]),s("div",[t._v(t._s(t.customer.username))])]),s("div",[s("div",[t._v("手机号：")]),s("div",[t._v(t._s(t.customer.mobile))])])])]),s("div",{staticClass:"order-subside-card"},[s("div",{staticClass:"order-block-title"},[t._v("配送信息")]),s("div",{staticClass:"order-block-content"},[s("div",[s("div",[t._v("姓名：")]),s("div",[t._v(t._s(t.address.name))])]),s("div",[s("div",[t._v("地址：")]),s("div",[t._v(t._s(t.address.address))])]),s("div",[s("div",[t._v("电话：")]),s("div",[t._v(t._s(t.address.mobile))])]),s("div",[s("div",[t._v("邮编：")]),s("div",[t._v(t._s(t.address.zip))])])])])])]),s("el-dialog",{attrs:{title:"发货",visible:t.sendDialogShow,width:"600px"},on:{"update:visible":function(e){t.sendDialogShow=e}}},[s("div",{staticClass:"send-content"},[s("div",{staticClass:"send-header"},[t._v("待发货商品")]),t._l(t.pend_items,(function(e,i){return s("div",{key:i},[s("el-checkbox",{staticClass:"select-item",attrs:{label:e},model:{value:t.selected_items,callback:function(e){t.selected_items=e},expression:"selected_items"}},[s("div",[s("span",[t._v(t._s(e.product_title))]),s("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(e.variant_title))])]),s("div",[s("el-input",{attrs:{size:"mini"},model:{value:e.amount,callback:function(s){t.$set(e,"amount",s)},expression:"item.amount"}})],1)])],1)}))],2),s("el-form",{attrs:{"label-width":"68px"}},[s("el-form-item",{attrs:{label:"运输公司"}},[s("el-input",{model:{value:t.sendInfo.shipment_company,callback:function(e){t.$set(t.sendInfo,"shipment_company",e)},expression:"sendInfo.shipment_company"}})],1),s("el-form-item",{attrs:{label:"运单号"}},[s("el-input",{model:{value:t.sendInfo.shipment_no,callback:function(e){t.$set(t.sendInfo,"shipment_no",e)},expression:"sendInfo.shipment_no"}})],1),s("div",{staticStyle:{"text-align":"right"}},[s("el-button",{on:{click:function(e){t.sendDialogShow=!1}}},[t._v("取消")]),s("el-button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:t.sendOrder}},[t._v("确认发货")])],1)],1)],1)],1)},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"order-block-title"},[s("strong",[t._v("客户备注")])])}],n=(s("4de4"),s("d81d"),s("f8b7")),r={data:function(){return{id:null,no:null,customer:{},items:{},payment:{},address:{},shipments:[],items_amount:null,discounts_amount:null,shipments_amount:null,amount:null,ori_amount:null,status:null,status_value:null,refund_at:null,refund_status:null,refund_status_value:null,remark:null,send_at:null,pay_at:null,success_at:null,created_at:null,status_active:0,status_processes:[],sendDialogShow:!1,sendInfo:{shipment_company:null,shipment_no:null},pend_items:[],selected_items:[],btnLoading:!1}},methods:{getData:function(){var t=this;this.$loading(),Object(n["a"])(this.$route.query.id).then((function(e){t.$loading().close();var s=e.data.body;if(t.id=t.$route.query.id,t.no=s.no,t.customer=s.customer,t.items=s.items,t.payment=s.payment,t.address=s.address,t.shipments=s.shipments,t.items_amount=s.items_amount,t.discounts_amount=s.discounts_amount,t.shipments_amount=s.shipments_amount,t.amount=s.amount,t.ori_amount=s.ori_amount,t.status=s.status,t.status_value=s.status_value,t.refund_status=s.refund_status,t.refund_status_value=s.refund_status_value,t.refund_at=s.refund_at,t.remark=s.remark,t.send_at=s.send_at,t.pay_at=s.pay_at,t.success_at=s.success_at,t.created_at=s.created_at,s.refund_status)switch(s.refund_status){case"refunding":t.status_active=3,t.status_processes=[{value:"订单创建"},{value:"订单支付"},{value:"退单申请"},{value:"订单关闭"}];break;case"refunded":t.status_active=4,t.status_processes=[{value:"订单创建"},{value:"订单支付"},{value:"退单申请"},{value:"订单关闭"}];break}else switch(s.status){case"pending":t.status_active=1,t.status_processes=[{value:"订单创建"},{value:"订单支付"},{value:"配送中"},{value:"已完成"}];break;case"processing":t.status_active=2,t.status_processes=[{value:"订单创建"},{value:"订单支付"},{value:"配送中"},{value:"已完成"}];break;case"partial":case"sent":t.status_active=3,t.status_processes=[{value:"订单创建"},{value:"订单支付"},{value:"配送中"},{value:"已完成"}];break;case"success":t.status_active=4,t.status_processes=[{value:"订单创建"},{value:"订单支付"},{value:"配送中"},{value:"已完成"}];break;case"cancel":t.status_active=2,t.status_processes=[{value:"订单创建"},{value:"已取消"}];break;case"closed":t.status_active=2,t.status_processes=[{value:"订单创建"},{value:"已关闭"}];break}})).catch((function(){t.$message.warning("参数错误"),t.$router.push({name:"OrderList"}),t.$loading().close()}))},refundOrder:function(t){var e=this;"refunded"===t?Object(n["d"])(this.id,{status:t,reason:""}).then((function(){e.$message.success("退单完成"),e.getData()})):this.$prompt("请输入理由","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(s){var i=s.value;Object(n["d"])(e.id,{status:t,reason:i}).then((function(){e.$message.success("退单已驳回"),e.getData()}))})).catch((function(){}))},closedOrder:function(){var t=this;this.$confirm("此操作将取消该订单, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(n["d"])(t.id,{status:"closed"}).then((function(){t.$message.success("关闭成功"),t.getData()}))})).catch((function(){t.$message({type:"info",message:"已取消"})}))},updatePriceOrder:function(){var t=this;this.$prompt("请输入价格","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(e){var s=e.value;Object(n["e"])(t.id,{amount:s}).then((function(){t.$message.success("修改成功"),t.getData()}))})).catch((function(){t.$message({type:"info",message:"已取消"})}))},toSend:function(){var t=this;this.selected_items=[],this.pend_items=[];var e=[];this.shipments.map((function(t){t.items.map((function(t){e.push(t)}))})),this.items.map((function(s){var i=e.filter((function(t){return t.variant_id===s.variant_id}));if(0===i.length){var a={product_title:s.product_title,variant_title:s.variant_title,variant_id:s.variant_id,amount:s.quantity};t.pend_items.push(a),t.selected_items.push(a)}else if(i[0].quantity!==s.quantity){var n={product_title:s.product_title,variant_title:s.variant_title,variant_id:s.variant_id,amount:s.quantity-i[0].quantity};t.pend_items.push(n),t.selected_items.push(n)}})),this.sendDialogShow=!0,this.sendInfo.shipment_company="",this.sendInfo.shipment_no=""},sendOrder:function(){var t=this;if(0!==this.selected_items.length)if(this.sendInfo.shipment_company)if(this.sendInfo.shipment_no){var e=[];this.selected_items.map((function(t){e.push({variant_id:t.variant_id,quantity:t.amount})})),this.sendInfo["items"]=e,Object(n["c"])(this.id,this.sendInfo).then((function(){t.$message.success("发货成功"),t.sendDialogShow=!1,t.getData()}))}else this.$message.warning("请填写运单号");else this.$message.warning("请填写运输公司");else this.$message.warning("请选择发货商品")}},created:function(){this.$route.query.id?this.getData():(this.$message.warning("参数错误"),this.$router.push({name:"OrderList"}))}},u=r,d=(s("131d"),s("f258"),s("2877")),c=Object(d["a"])(u,i,a,!1,null,"420dcf81",null);e["default"]=c.exports},8415:function(t,e,s){},ea10:function(t,e,s){},f258:function(t,e,s){"use strict";var i=s("ea10"),a=s.n(i);a.a},f8b7:function(t,e,s){"use strict";s.d(e,"b",(function(){return a})),s.d(e,"a",(function(){return n})),s.d(e,"d",(function(){return r})),s.d(e,"e",(function(){return u})),s.d(e,"c",(function(){return d}));var i=s("b775");function a(t){return Object(i["a"])({url:"order",method:"get",params:t})}function n(t){return Object(i["a"])({url:"order/"+t,method:"get"})}function r(t,e){return Object(i["a"])({url:"order/status/"+t,method:"put",data:e})}function u(t,e){return Object(i["a"])({url:"order/"+t,method:"put",data:e})}function d(t,e){return Object(i["a"])({url:"order/"+t+"/shipment",method:"post",data:e})}}}]);