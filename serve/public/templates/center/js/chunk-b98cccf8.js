(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b98cccf8"],{"0776":function(t,e,i){t.exports=i.p+"templates/center/img/balloon_two_color.png"},"12de":function(t,e,i){"use strict";i.d(e,"c",(function(){return s})),i.d(e,"b",(function(){return a})),i.d(e,"a",(function(){return o}));var n=i("b775");function s(){return Object(n["a"])({url:"shop/template",method:"get"})}function a(t){return Object(n["a"])({url:"shop/template/"+t,method:"get"})}function o(t,e){return Object(n["a"])({url:"shop/template/"+e,method:"put",data:t})}},1832:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"web-container"},[n("div",{staticClass:"web-header"},[t._v(" 商城配置 "),n("div",{staticClass:"back-button",staticStyle:{cursor:"pointer"},on:{click:t.returnCenter}},[t._v("回到主控台")])]),n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"back-content"},[1===t.activeIndex?n("set-basic",{attrs:{shop:t.shop,btnLoading:t.btnLoading},on:{confirm:t.setBasic}}):t._e(),2===t.activeIndex?n("set-theme",{attrs:{activeIndex:t.activeIndex,shop:t.shop,btnLoading:t.btnLoading},on:{confirm:t.confirmTheme,prev:t.toPrev,complete:t.confirm}}):t._e(),4===t.activeIndex?n("div",[t.isComplete?t._e():n("div",[t._m(0),n("div",{staticClass:"image-tip-text"},[t._v("安装中...")])]),n("transition",{attrs:{name:"success"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.isComplete,expression:"isComplete"}],staticClass:"setup-success"},[n("div",{staticClass:"image-tip"},[n("img",{attrs:{src:i("bd25")}})]),n("div",{staticClass:"image-tip-text"},[t._v("安装成功")])])]),t.isComplete?n("div",{staticStyle:{"text-align":"center","margin-top":"40px"}},[n("el-button",{attrs:{type:"primary"},on:{click:t.returnCenter}},[t._v("回到商城列表")]),n("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.$router.push({name:"Dashboard"})}}},[t._v("进入商城")])],1):t._e()],1):t._e()],1)])},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"image-tip image-tip-floating"},[n("img",{attrs:{src:i("0776")}})])}],a=(i("ac1f"),i("1276"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"set-title"},[t._v("商城基础设置")]),n("div",{staticClass:"set-image",style:{height:t.height+"px"}},[n("img",{attrs:{src:i("b2f2")}})]),n("div",{staticClass:"set-form"},[n("div",{staticClass:"set-form-item"},[n("div",[t._v("商城名称")]),n("div",[n("el-input",{model:{value:t.shop.shop_name,callback:function(e){t.$set(t.shop,"shop_name",e)},expression:"shop.shop_name"}})],1)]),n("div",{staticClass:"set-form-item"},[n("div",[t._v("域名地址")]),n("div",[n("el-input",{attrs:{disabled:"免费版"===t.shop.shop_level},model:{value:t.shop.shop_url,callback:function(e){t.$set(t.shop,"shop_url",e)},expression:"shop.shop_url"}},[n("span",{attrs:{slot:"append"},slot:"append"},[t._v("."+t._s(t.shop.shop_host))])]),"免费版"===t.shop.shop_level?n("div",{staticClass:"set-tip"},[t._v("免费版域名地址自动生成，如需自定义域名地址，可在商城后台中升级")]):t._e()],1)]),n("div",{staticClass:"set-form-button"},[n("el-button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:t.confirm}},[t._v("下一步")])],1)])])}),o=[],r={props:{shop:Object,btnLoading:Boolean},data:function(){return{height:0}},mounted:function(){var t=this;this.$nextTick((function(){window.innerHeight-482>100?t.height=window.innerHeight-482:t.height=100})),window.onresize=function(){window.innerHeight-482>100?t.height=window.innerHeight-482:t.height=100}},methods:{confirm:function(){this.$emit("confirm")}}},c=r,h=(i("29a87"),i("2877")),l=Object(h["a"])(c,a,o,!1,null,"78200c58",null),d=l.exports,p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"set-title"},[t._v("主题选择")]),void 0!==t.current_theme.template_id?i("div",{staticClass:"current-theme"},[t._v("当前主题："),i("strong",[t._v(t._s(t.current_theme.template_name))])]):t._e(),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"set-theme-list",style:{height:t.height+"px"}},t._l(t.themes,(function(e,n){return i("el-radio",{key:n,staticClass:"theme-items",attrs:{label:e,disabled:e.hasTheme},model:{value:t.selected_theme,callback:function(e){t.selected_theme=e},expression:"selected_theme"}},[i("div",[i("div",{staticClass:"theme-title"},[t._v("主题"+t._s(n+1)+"："),i("strong",[t._v(t._s(e.template_name))])]),i("div",{staticClass:"theme-image"},[i("el-image",{staticStyle:{width:"200px"},attrs:{fit:"contain",src:e.template_img}})],1),e.template_content?i("div",[t._v("适用场景："+t._s(e.template_content))]):t._e(),i("div",[i("span",[t._v("购买时长")]),i("el-select",{staticStyle:{width:"154px","margin-left":"10px"},attrs:{disabled:e.hasTheme},on:{change:function(i){return t.changeVariant(e)}},model:{value:e.current_variant_id,callback:function(i){t.$set(e,"current_variant_id",i)},expression:"theme.current_variant_id"}},t._l(e.variants,(function(t,e){return i("el-option",{key:"v"+e,attrs:{value:t.variant_id,label:t.time+"个月"}})})),1)],1),i("div",{staticClass:"theme-price"},[t._v("价格：¥ "),i("strong",[t._v(t._s(e.current_price))])])])])})),1),i("div",{staticClass:"payment-list"},[i("span",{staticStyle:{"margin-right":"10px"}},[t._v("支付方式：")]),i("el-radio-group",{attrs:{size:"small",disabled:t.themes.filter((function(t){return t.hasTheme})).length===t.themes.length},model:{value:t.payment_method,callback:function(e){t.payment_method=e},expression:"payment_method"}},t._l(t.payments,(function(e,n){return i("el-radio-button",{key:n,attrs:{label:e.method_code}},[t._v(t._s(e.method_title))])})),1)],1),i("div",{staticClass:"set-form-button"},[i("el-button",{attrs:{type:"primary",plain:""},on:{click:t.toPrev}},[t._v("上一步")]),i("el-button",{attrs:{type:"primary",disabled:t.themes.filter((function(t){return t.hasTheme})).length===t.themes.length,loading:t.payLoading},on:{click:t.toPay}},[t._v("保存")]),t.hasSet?i("el-button",{attrs:{type:"primary",plain:""},on:{click:t.toComplete}},[t._v("完成设置")]):t._e()],1),i("el-dialog",{attrs:{visible:t.tipShow,title:"提示","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,center:""}},[i("div",{staticClass:"dialog-tip"},[i("div",[t._v("付款过程中请勿关闭当前页面，付款成功后请点击“付款成功”按钮，即可创建商城并设置商城基础信息")]),i("div",[t._v("付款失败或取消付款，请点击“取消付款”按钮，关闭弹窗")])]),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.tipShow=!1}}},[t._v("取消付款")]),i("el-button",{attrs:{size:"small",type:"primary",loading:t.btnLoading},on:{click:t.validPay}},[t._v("付款成功")])],1)])],1)},m=[],u=(i("4de4"),i("d81d"),i("a9e3"),i("12de")),_=i("e692"),v=i("825f"),g={props:{shop:Object,activeIndex:Number},data:function(){return{loading:!1,themes:[],height:0,selected_theme:{},selected_variant_id:"",payments:[],payment_method:"",payVisible:!1,payTitle:"",gotUrl:!1,url:"",current_theme:{},payLoading:!1,tipShow:!1,order_no:"",hasSet:!1,btnLoading:!1}},mounted:function(){var t=this;this.$nextTick((function(){t.height=window.innerHeight-377})),window.onresize=function(){t.height=window.innerHeight-377}},methods:{getThemes:function(){var t=this;this.loading=!0,Object(u["c"])().then((function(e){0!==e.data.body.length&&(t.hasSet=!0,t.current_theme=e.data.body.filter((function(t){return t.active}))[0]),t.getPayments(),Object(_["d"])().then((function(i){if(t.themes=i.data.body,t.loading=!1,0!==t.themes.length){t.selected_theme=t.themes[0],t.selected_variant_id=t.themes[0].variants[0].variant_id;var n=e.data.body;t.themes.map((function(t){t["current_variant_id"]=t.variants[0].variant_id,t["current_price"]=t.variants[0].price,0!==n.length&&0!==n.filter((function(e){return e.template_id===t.template_id})).length?t["hasTheme"]=!0:t["hasTheme"]=!1}))}})).catch((function(){t.loading=!1}))})).catch((function(){t.loading=!1}))},getPayments:function(){var t=this;Object(v["d"])().then((function(e){t.payments=e.data.body,t.payment_method=t.payments[0].method_code}))},changeVariant:function(t){t.current_price=t.variants.filter((function(e){return e.variant_id===t.current_variant_id}))[0].price,this.selected_variant_id=t.current_variant_id},toPrev:function(){this.$emit("prev")},toComplete:function(){this.$emit("complete")},toPay:function(){var t=this;this.payLoading=!0;var e={shop_id:this.$store.getters.shop_id,payment_method:this.payment_method,item:{type:"template",item_id:this.selected_variant_id}};Object(v["a"])(e).then((function(e){t.order_no=e.data.body.no,"免费版"===t.$store.getters.shop_level?(t.payLoading=!1,t.hasSet=!0,t.confirm()):(window.open(e.data.body.payment.pay_url,"_blank"),t.payLoading=!1,t.tipShow=!0)})).catch((function(){t.payLoading=!1}))},validPay:function(){var t=this;this.$loading(),Object(v["c"])(this.order_no).then((function(e){"paid"===e.data.body.status_code?(t.$message.success({message:"主题购买成功",duration:1e3}),setTimeout((function(){t.confirm(),t.hasSet=!0,t.$loading().close()}),1e3)):(t.$message.error({message:"未检测到成功的支付订单，请检查支付是否成功，如果确认支付成功，请联系客服核对并开通商城",duration:4e3}),t.$loading().close())})).catch((function(e){t.$message.error({message:e.response.data.message,duration:2e3}),t.$loading().close()}))},closePay:function(){this.payVisible=!1,this.gotUrl=!1,this.url="",this.payTitle=""},confirm:function(){this.$emit("confirm")}},watch:{activeIndex:{deep:!0,immediate:!0,handler:function(){2===this.activeIndex&&this.getThemes()}}}},f=g,b=(i("b64f"),i("f06a"),Object(h["a"])(f,p,m,!1,null,"8804ccce",null)),y=b.exports,x={components:{SetBasic:d,SetTheme:y},data:function(){return{activeIndex:1,loading:!1,shop:{shop_name:"",shop_level:"",shop_url:"",shop_status:"",shop_id:"",shop_active:"",shop_host:"",shop_exp:""},btnLoading:!1,isComplete:!1,changeName:!1,changeUrl:!1}},created:function(){this.loading=!0},methods:{toPrev:function(){this.activeIndex-=1,this.changeName=!1,this.changeUrl=!1},setBasic:function(){var t=this;if(this.changeName||this.changeUrl){this.btnLoading=!0;var e={shop_name:this.shop.shop_name,shop_url:this.shop.shop_url};Object(_["a"])(e).then((function(){t.activeIndex=2,t.btnLoading=!1})).catch((function(){t.btnLoading=!1}))}else this.activeIndex=2},confirmTheme:function(){this.$message.success("创建主题成功"),this.confirm()},confirm:function(){var t=this;this.activeIndex=4,Object(_["a"])({status:"active"}).then((function(){setTimeout((function(){t.isComplete=!0}),5e3)})).catch((function(e){t.activeIndex=3,t.$message.error(e.response.data.message)}))},returnCenter:function(){var t=location.origin.split("."),e="//account."+t[t.length-2]+"."+t[t.length-1];location.href=e}},watch:{"$store.getters.shop_status":{handler:function(t){""!==t&&(this.loading=!1,this.shop.shop_name=this.$store.getters.shop_name,this.shop.shop_level=this.$store.getters.shop_level,this.shop.shop_url=this.$store.getters.shop_url,this.shop.shop_id=this.$store.getters.shop_id,this.shop.shop_status=this.$store.getters.shop_status,this.shop.shop_host=this.$store.getters.shop_host,this.shop.shop_active=this.$store.getters.shop_active,this.shop.shop_exp=this.$store.getters.shop_exp,"active"===this.shop.shop_status&&this.$router.push({name:"Dashboard"}))}},"shop.shop_name":{deep:!0,immediate:!0,handler:function(t,e){this.changeName=t!==e}},"shop.shop_url":{deep:!0,immediate:!0,handler:function(t,e){this.changeUrl=t!==e}}}},w=x,C=(i("a0ab"),Object(h["a"])(w,n,s,!1,null,"61467722",null));e["default"]=C.exports},"29a87":function(t,e,i){"use strict";var n=i("81fc"),s=i.n(n);s.a},"2d31":function(t,e,i){},"81fc":function(t,e,i){},a0ab:function(t,e,i){"use strict";var n=i("2d31"),s=i.n(n);s.a},ace0:function(t,e,i){},b2f2:function(t,e,i){t.exports=i.p+"templates/center/img/marginalia-online-shopping.png"},b64f:function(t,e,i){"use strict";var n=i("e179"),s=i.n(n);s.a},bd25:function(t,e,i){t.exports=i.p+"templates/center/img/shopping.png"},e179:function(t,e,i){},f06a:function(t,e,i){"use strict";var n=i("ace0"),s=i.n(n);s.a}}]);